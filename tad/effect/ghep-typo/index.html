<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script> var tmbq = '127.0.0.1'; </script>
    <link as='style' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css'
        media='all' rel='stylesheet' />

    <script crossorigin='anonymous'
        integrity='sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=='
        src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js'></script>


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" media="all">

</head>

<body class="col-lg-6">
    <style>
        .chonanh-avt {
            width: 38px;
            height: 38px;
            float: left;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
            margin-right: 10px
        }

        .img-preview {
            width: 36px;
            height: 36px;
            background: url(//2.bp.blogspot.com/-ZTMZs1MahXE/XqZq3WgQKDI/AAAAAAAAdRI/ib4MFhw49m82VLY9b2LzZBw5w3tItLSrQCK4BGAYYCw/s36/thumbnail-man.png) no-repeat center;
            background-size: 36px
        }
        .democan {
    background: #eee;
    border-radius: 0.25rem;
    border: 1px solid #ddd;
}
        .canvas-container {
            width: 100% !important;
            height: auto !important;display: flex;
        }

        .lower-canvas {
            width: 100% !important;
            height: auto !important;
            position: relative !important
        }

        .upper-canvas {
            width: 100% !important;
            height: auto !important;
            position: absolute !important
        }



        .tad-dai .lower-canvas, .tad-dai .upper-canvas {
    max-height: 500px;
    width: auto !important;
    top: inherit !important;
    left: inherit !important;
}



.canvas-container.tad-dai {justify-content: center;}

    </style>

<label>Màu chữ typo</label>

<div class="chonmau mb-2">
       
    <div class="custom-control custom-radio custom-control-inline">
        <input type="radio" id="kieu1" name="kieu1" class="custom-control-input" checked="">
        <label class="custom-control-label" for="kieu1">Đen</label>
        </div>

    <div class="custom-control custom-radio custom-control-inline">
        <input type="radio" id="kieu2" name="kieu1" class="custom-control-input">
        <label class="custom-control-label" for="kieu2">Trắng</label>
        </div>
 
 
    </div>


    <label><b>Upload ảnh (png)*</b></label>
    <div class="mb-2">
        <div class="chonanh-avt">
            <div class="img-preview"></div>
        </div>
        <label class="btn btn-primary m-0 mb-2 btn-upanh mr-2" for="tad-themanh"><i class="fas fa-upload"></i> Chọn
            ảnh</label>
        <input type="file" id="tad-themanh" accept=".jpg,.jpeg,.png,.gif,.bmp,.tiff" class="d-none" />
        <button class="btn btn-primary collapsed mb-2" style="display:none" id="tad-dc" style="" type="button"
            data-toggle="collapse" data-target="#collapseDieuchinh" aria-expanded="false"
            aria-controls="collapseDieuchinh"><i class="fas fa-arrows-alt"></i></button>
    </div>
    <div class="collapse" id="collapseDieuchinh">
        <label class="m1">Điều chỉnh:
            <a href="javascript:void(0)"
                onclick="alert('Dùng 1 ngón tay để di chuyển\nDùng 2 ngón tay để xoay, thu nhỏ, phóng to')"><i
                    class="far fa-question-circle"></i></a>
        </label>
        <div class="democan" class="mt-3">
            <canvas id="temp" width="500" height="500"></canvas>
        </div>
    </div>

    <div>
    </div>
    <div class="mt-3">
        <button type="button" class="btn btn-primary disabled" id="tad-taoanh"><i class="fas fa-cut"></i> Tạo
            ảnh</button>
    </div>
    <div id="img-out"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.7.9/fabric.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.7/hammer.min.js"
        integrity="sha512-fKSoxqVPlyflaK5sUZYigOGAnjMChqysp0xksbgt+pI5N+e4fT5DGGMdvLS6MvYo4S6rZ2gmg5tUpMwpNk0AcA=="
        crossorigin="anonymous"></script>
    <script src="https://cdn.taoanhdep.com/tphoto/FileSaver.js"></script>
    <script src="https://cdn.taoanhdep.com/tphoto/fontfaceobserver.js"></script>
    <script src="https://cdn.taoanhdep.com/tphoto/fabriccontrol.js"></script>
    <link href='https://cdn.taoanhdep.com/tad/effect/avt-anime/fonts/stylesheet.css' media='all' rel='stylesheet' />
    <link rel='stylesheet'
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/2.5.3/css/bootstrap-colorpicker.min.css" />
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/2.5.3/js/bootstrap-colorpicker.min.js"></script>



    <script>/*<![CDATA[*/

        var tenanhxuat = "avatar_anime";
        $(document).ready(function () {
            if (window.location.hostname == tmbq) {
                $(".btn-huongdan").click(function () {
                    alert("tự mò đi cái gì cũng hỏi")
                });
                var e = $(".tad-in-text0");
                var h = $(".tad-in-text1");
                e.on("input", function () {
                    g()
                });
                h.on("input", function () {
                    g()
                });

                function g() {
                    if (undefined !== e.val() && e.val().length == 0) {
                        $("#tad-taoanh").addClass("disabled")
                    } else {
                        if (undefined !== h.val() && h.val().length == 0) {
                            $("#tad-taoanh").addClass("disabled")
                        } else {
                            $("#tad-taoanh").removeClass("disabled")
                        }
                    }
                }
                var c = new FontFaceObserver("MTD William Letter");
                c.load().then(function () {
                    var a = new FontFaceObserver("Steelfish");
                    a.load().then(function () {
                        var O = new fabric.Canvas("temp");


                        fabric.Object.prototype.customiseCornerIcons({
                            settings: {
                                borderColor: "white",
                                cornerSize: 10,
                                cornerShape: "circle",
                                cornerBackgroundColor: "white",
                                cornerPadding: 20
                            }
                        });


                        var b;
                        O.backgroundColor = "#999";
                        O.renderAll();

                    
                        $(".tad-in-text1").on("input", function () {
                            edittext = $(this).val().toUpperCase();
                            I.set("text", edittext);
                            K.set("text", edittext);
                            L.set("text", edittext);
                            O.renderAll()
                        });
                        $(".tad-in-text0").on("input", function () {
                            G.set("text", $(this).val());
                            O.renderAll()
                        });
                        $("#tad-themanh").on("change", function (j) {
               
                            var k = j.target.files[0];
                            var i = new FileReader();
                            i.onload = function (l) {
                                var m = URL.createObjectURL(j.target.files[0]);
                                $(".img-preview").css("background-image", "url(" + m + ")");
                                var max = 500;
                                fabric.Image.fromURL(m, function (o) {
                                    O.remove(b);
                                    fabric.Image.fromURL(m, function (q) {
                                        if (q.width >= q.height) {

                                            O.setDimensions({ width: max, height: max * q.height / q.width });

                                            $(".canvas-container").removeClass("tad-dai")
                                            console.log("a")
                                        }
                                        else {
                                            O.setDimensions({ width: max * q.width / q.height, height: max });
                                            $(".canvas-container").addClass("tad-dai")
                                            console.log("b")
                                        }
                                        O.setBackgroundImage(q, O.renderAll.bind(O), {
                                            scaleX: O.width / q.width,
                                            scaleY: O.height / q.height
                                        });


                                        O.renderAll();

                                    })
                                })
                            };
                            i.readAsDataURL(k);




                            $("#tad-dc").show();
                            $("#collapseDieuchinh").collapse('show');
                            $(".btn-upanh").html("<i class='fas fa-upload'></i> Chọn ảnh khác")
                        });


                        fabric.Image.fromURL("https://3.bp.blogspot.com/-tyBj-iCPMkA/Xp6kh4MDvXI/AAAAAAAAByU/3S9lFVsRcHQKAShT_AiHgQSCrHq4LZ-agCLcBGAsYHQ/s1600/52469048_342701919919557_4698409718895345664_n.jpg", function (i) {
                            var j = i.set({
                                left: 20,
                                top: 20,
                                width: O.width,
                                height: O.height,
                                globalCompositeOperation:"multiply",
                                

                            }).scale(0.5);
                           


                            var filter = new fabric.Image.filters.Invert();
j.filters.push(filter);
j.applyFilters(O.renderAll.bind(O));


                            O.add(j)
                            O.setActiveObject(j);
                           
                        }, {
                            crossOrigin: "anonymous"
                        });


                        $(".chonmau #kieu2").click(function(){


                        })


                        var B = null;
                        var d = null;
                        var f = null;
                        var C = null;
                        var D = 1;
                        var M = 1;
                        var N = 1;
                        var F = 0;
                        var R = new Hammer.Manager(O.upperCanvasEl);
                        var A = new Hammer.Rotate();
                        var Q = new Hammer.Pinch();
                        R.add([Q, A]);
                        R.get("rotate").set({
                            enable: true
                        });
                        R.get("pinch").set({
                            enable: true
                        });
                        R.on("pinchstart rotatestart", function (j) {
                            console.log("start");
                            F -= j.rotation;
                            if (O.getActiveObject()) {
                                var i = O.getActiveObject();
                                M = i.scaleX;
                                N = i.scaleY
                            }
                        });
                        R.on("pinchmove rotatemove", function (j) {
                            C = F + j.rotation;
                            B = D * j.scale;
                            if (O.getActiveObject()) {
                                var i = O.getActiveObject();
                                d = M * j.scale;
                                f = N * j.scale;
                                if (!(d > i.minScaleLimit && f > i.minScaleLimit)) {
                                    d = i.scaleX;
                                    f = i.scaleY
                                }
                                i.set({
                                    lockMovementX: true,
                                    lockMovementY: true
                                });
                                i.set("scaleX", d);
                                i.set("scaleY", f);
                                i.rotate(C);
                                i.setCoords();
                                O.renderAll()
                            }
                        });
                        R.on("pinchend rotateend", function (j) {
                            D = B;
                            F = C;
                            M = d;
                            N = f;
                            if (O.getActiveObject()) {
                                var i = O.getActiveObject();
                                setTimeout(function () {
                                    i.set({
                                        lockMovementX: false,
                                        lockMovementY: false
                                    })
                                }, 300)
                            }
                            O.renderAll()
                        });
                        $("#tad-taoanh").click(function () {
                            $("#img-out").hide();
                            $("#tad-taoanh").addClass("disabled").html("<span class='spinner-border spinner-border-sm'></span> Đang tạo ảnh");
                            O.deactivateAll();
                            O.renderAll();
                            tadUpload($("#temp").get(0))
                        })
                    })
                })
            }
        });


        /*]]>*/</script>


</body>

</html>